<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Furniture Price Generator - Web</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container-fluid mt-2">
        <!-- Compact Header Section - SAME AS DESKTOP -->
        <div class="row mb-2">
            <div class="col-12">
                <div class="d-flex align-items-center justify-content-between py-2 px-3" style="background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <!-- Logo di kiri - 80px seperti desktop -->
                    <div class="d-flex align-items-center">
                        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" style="height: 80px; width: auto;">
                    </div>
                    
                    <!-- Company Info di kanan - compact -->
                    <div class="text-end small" style="font-size: 9px; color: #2c3e50;">
                        <div style="font-size: 11px; color: #c0392b; font-weight: bold;">PT. ENIGMA PRISMA DELAPAN</div>
                        <div style="font-size: 8px;">Jl. Raya H. Abdullah No.56, Pakulonan Barat<br>Tangerang - 0821 1213 4258</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Title and controls in one line - COMPACT LIKE DESKTOP -->
        <div class="row mb-2">
            <div class="col-12">
                <div class="d-flex align-items-center justify-content-between py-2 px-3" style="background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h3 class="mb-0" style="color: #2c3e50;">Furniture Price Generator</h3>
                    
                    <div class="d-flex align-items-center gap-3">
                        <label class="mb-0 small">Kategori:</label>
                        <select class="form-select form-select-sm" id="kategoriSelect" style="width: 150px;">
                            <option value="Kitchen Set">Kitchen Set</option>
                            <option value="Wardrobe">Wardrobe</option>
                            <option value="Bed">Bed</option>
                            <option value="Backdrop Panel">Backdrop Panel</option>
                            <option value="Credenza">Credenza</option>
                            <option value="Multi Cabinet">Multi Cabinet</option>
                            <option value="Custom Furniture">Custom Furniture</option>
                        </select>
                        
                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="toggleTheme()" style="width: 40px;">
                            <i class="fas fa-moon"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Separator line seperti desktop -->
        <div class="row mb-3">
            <div class="col-12">
                <div style="height: 2px; background-color: #c0392b; border-radius: 1px;"></div>
            </div>
        </div>

        <div class="row">
            <!-- Left Panel - Input Form -->
            <div class="col-lg-4 mb-4">
                <div class="card shadow">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0"><i class="fas fa-plus-circle"></i> Tambah Item</h5>
                    </div>
                    <div class="card-body">
                        <form id="itemForm">
                            <!-- Category Selection -->
                            <div class="mb-3">
                                <label class="form-label">Kategori</label>
                                <select class="form-select" id="category" onchange="updateSubItems()">
                                    <option value="Kitchen Set KB">Kitchen Set KB</option>
                                    <option value="Kitchen Set KA">Kitchen Set KA</option>
                                    <option value="Wardrobe">Wardrobe</option>
                                    <option value="Bed Frame">Bed Frame</option>
                                    <option value="Backdrop Panel">Backdrop Panel</option>
                                    <option value="Credenza">Credenza</option>
                                    <option value="Multi Cabinet">Multi Cabinet</option>
                                    <option value="Custom">Custom</option>
                                </select>
                            </div>

                            <!-- Sub Item -->
                            <div class="mb-3">
                                <label class="form-label">Sub Item</label>
                                <select class="form-select" id="subItem">
                                    <option value="Kitchen Bawah">Kitchen Bawah</option>
                                </select>
                            </div>

                            <!-- Dimensions dengan validasi real-time seperti desktop -->
                            <div class="row mb-3">
                                <div class="col-4">
                                    <label class="form-label">Panjang (m)</label>
                                    <input type="number" step="0.01" class="form-control validated-number" id="panjang" 
                                           placeholder="Contoh: 3.00" min="0.01" max="999999.99" required 
                                           oninput="validateNumberInput(this)" onblur="formatNumberInput(this)">
                                    <div class="invalid-feedback">Harus angka positif > 0</div>
                                </div>
                                <div class="col-4">
                                    <label class="form-label">Lebar (m)</label>
                                    <input type="number" step="0.01" class="form-control validated-number" id="lebar" 
                                           placeholder="Contoh: 0.85" min="0.01" max="999999.99" required
                                           oninput="validateNumberInput(this)" onblur="formatNumberInput(this)">
                                    <div class="invalid-feedback">Harus angka positif > 0</div>
                                </div>
                                <div class="col-4">
                                    <label class="form-label">Tinggi (m)</label>
                                    <input type="number" step="0.01" class="form-control validated-number" id="tinggi" 
                                           placeholder="Contoh: 0.60" min="0.01" max="999999.99" required
                                           oninput="validateNumberInput(this)" onblur="formatNumberInput(this)">
                                    <div class="invalid-feedback">Harus angka positif > 0</div>
                                </div>
                            </div>

                            <!-- Finishing dengan deskripsi seperti desktop -->
                            <div class="mb-3">
                                <label class="form-label">Finishing</label>
                                <select class="form-select" id="finishing" onchange="updateFinishingInfo()">
                                    <option value="Tacosheet">Tacosheet</option>
                                    <option value="HPL Low" selected>HPL Low</option>
                                    <option value="HPL Mid">HPL Mid</option>
                                    <option value="HPL High">HPL High</option>
                                    <option value="Duco">Duco</option>
                                    <option value="Kombinasi">Kombinasi</option>
                                </select>
                                
                                <!-- Info finishing seperti desktop -->
                                <div id="finishingInfo" class="mt-2">
                                    <small class="text-muted">
                                        <div style="background: #fff9e6; border: 1px solid #f39c12; border-radius: 4px; padding: 8px; font-size: 11px;">
                                            ðŸ“‹ <strong>KETERANGAN FINISHING:</strong><br>
                                            â€¢ Tacosheet: Luar tacosheet, dalam melamninto, ekonomis (Rp 2,3jt/mÂ²)<br>
                                            â€¢ HPL Low: Luar HPL, dalam melamninto, motif terbatas (Rp 2,3jt/mÂ²)<br>
                                            â€¢ HPL Mid: Luar HPL, dalam melamninto, motif standar (Rp 2,8jt/mÂ²)<br>
                                            â€¢ HPL High: Luar+dalam full HPL, semua motif tersedia (Rp 3,2jt/mÂ²)<br>
                                            â€¢ Duco: Cat duco premium, finishing halus (Rp 5,5jt/mÂ²)<br>
                                            â€¢ Kombinasi: Kombinasi HPL + duco (Rp 4,7jt/mÂ²)
                                        </div>
                                    </small>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-success w-100">
                                <i class="fas fa-plus"></i> Tambah Item
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="card shadow mt-3">
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-6">
                                <button class="btn btn-info w-100" onclick="showCustomerModal()">
                                    <i class="fas fa-user"></i> Customer
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-warning w-100" onclick="showPricingModal()">
                                    <i class="fas fa-percentage"></i> Diskon & Pajak
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-primary w-100" onclick="showTotal()">
                                    <i class="fas fa-calculator"></i> Total
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-danger w-100" onclick="clearAllItems()">
                                    <i class="fas fa-trash"></i> Hapus Semua
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-success w-100" onclick="saveProject()">
                                    <i class="fas fa-save"></i> Simpan
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-secondary w-100" onclick="document.getElementById('loadFile').click()">
                                    <i class="fas fa-folder-open"></i> Muat
                                </button>
                                <input type="file" id="loadFile" accept=".json" style="display: none;" onchange="loadProject(event)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Items List -->
            <div class="col-lg-8">
                <!-- Total Display -->
                <div class="card shadow mb-3 bg-success text-white">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col">
                                <h4 class="mb-0" id="totalDisplay">ðŸ’° Total: Rp 0 (0 item)</h4>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-money-bill-wave fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Items Table -->
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-list"></i> Daftar Item Furniture</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover mb-0">
                                <thead class="table-dark">
                                    <tr>
                                        <th>No</th>
                                        <th>Item</th>
                                        <th>Sub Item</th>
                                        <th>Dimensi</th>
                                        <th>Volume</th>
                                        <th>Finishing</th>
                                        <th>Harga</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="itemsTableBody">
                                    {% if items %}
                                        {% for item in items %}
                                        <tr data-item-id="{{ item.id }}">
                                            <td>{{ loop.index }}</td>
                                            <td>{{ item.nama_item }}</td>
                                            <td>{{ item.sub_item }}</td>
                                            <td>{{ item.dimensi }}</td>
                                            <td>{{ "%.2f"|format(item.total_volume) }} mÂ³</td>
                                            <td>{{ item.deskripsi }}</td>
                                            <td class="text-end">Rp {{ "{:,.0f}".format(item.jumlah) }}</td>
                                            <td>
                                                <button class="btn btn-sm btn-danger" onclick="deleteItem('{{ item.id }}')">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr id="noItemsRow">
                                            <td colspan="8" class="text-center text-muted py-4">
                                                <i class="fas fa-inbox fa-3x mb-3"></i><br>
                                                Belum ada item. Tambahkan item pertama Anda!
                                            </td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Info Modal -->
    <div class="modal fade" id="customerModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-user"></i> Informasi Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="customerForm">
                        <div class="mb-3">
                            <label class="form-label">Nama Customer</label>
                            <input type="text" class="form-control" id="customerName" value="{{ customer_info.name }}">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Alamat</label>
                            <textarea class="form-control" id="customerAddress" rows="3">{{ customer_info.address }}</textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Telepon</label>
                            <input type="text" class="form-control" id="customerPhone" value="{{ customer_info.phone }}">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" onclick="saveCustomer()">Simpan</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Pricing Info Modal -->
    <div class="modal fade" id="pricingModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-percentage"></i> Pengaturan Diskon & Pajak</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="pricingForm">
                        <div class="mb-3">
                            <label class="form-label">Diskon (%)</label>
                            <input type="number" step="0.01" class="form-control" id="discountPercent" value="{{ pricing_info.discount_percent }}">
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="useTax" {% if pricing_info.use_tax %}checked{% endif %}>
                                <label class="form-check-label" for="useTax">
                                    Gunakan Pajak/PPN
                                </label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Pajak (%)</label>
                            <input type="number" step="0.01" class="form-control" id="taxPercent" value="{{ pricing_info.tax_percent }}">
                        </div>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> Diskon akan dikurangi dari subtotal, lalu pajak dihitung dari hasil setelah diskon.
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-warning" onclick="savePricing()">Simpan</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="toast" class="toast" role="alert">
            <div class="toast-header">
                <strong class="me-auto" id="toastTitle">Notifikasi</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                <!-- Message will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Category and sub items mapping
        const categorySubs = {{ category_subs | tojson }};
        const finishingOptions = {{ finishing_options | tojson }};
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateSubItems();
            updateFinishingOptions();
            updateTotalDisplay();
        });
    </script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>